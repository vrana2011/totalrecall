<html>

<style>
    .results {
        font-size: 24px;
        padding: 15px;
        text-align: center;
        min-height: 150px;
    } 
    .button {
        background-color: #000000;
        -background-color: #cc0000;
        color: #FFFFFF;
        font-size: 14px;
        padding: 10px;
        border-radius: 10px;
        margin:10px
    }
   

</style>
<div>
    <h1 align="center">
        Total Recall
    </h1>
</div>    

<div align="center">
    <button id="start_button" onclick="startButton(event)" class="button">Start speaking</button>
</div>
<div align="center">
    <p id="info_speak_now" hidden>Speak now.</p>
    <p id="info_upgrade" hidden>Web Speech API is not supported by this browser.
        Upgrade to <a href="//www.google.com/chrome">Chrome</a>
        version 25 or later.
    </p>
</div>
<div id="results" class="results">
    <span id="final_span"></span> 
    <span id="interim_span"></span>
    <p>
</div>


<script>

var final_transcript = '';
var recognizing = false;
var ignore_onend;
var start_timestamp;

if (!('webkitSpeechRecognition' in window)) {
  upgrade();
} else {
  var recognition = new webkitSpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
 
  recognition.onstart = function() {
    console.log("onstart");   
    recognizing = true;
    document.getElementById("start_button").childNodes[0].nodeValue = "Save for recall";
    document.getElementById("start_button").style.backgroundColor = "#cc0000";
  };

  recognition.onend = function() {
    recognizing = false;
    document.getElementById("start_button").childNodes[0].nodeValue = "Start speaking";
    document.getElementById("start_button").style.backgroundColor = "#000000";
    if (ignore_onend) {
      return;
    }
  };


  recognition.onresult = function(event) {
    var interim_transcript = '';
    for (var i = event.resultIndex; i < event.results.length; ++i) {
      if (event.results[i].isFinal) {
        final_transcript += event.results[i][0].transcript;
      } else {
        interim_transcript += event.results[i][0].transcript;
      }
    }
    final_transcript = capitalize(final_transcript);
    final_span.innerHTML = linebreak(final_transcript);
    interim_span.innerHTML = linebreak(interim_transcript);
  };
}

function startButton(event) {
  if (recognizing) {
    console.log("startButton event: ", recognizing);
    recognition.stop();
    return;
  }
  console.log("startButton event: made it" );
  final_transcript = '';
  recognition.lang = 'en-US';
  recognition.start();
  ignore_onend = false;
  final_span.innerHTML = '';
  interim_span.innerHTML = '';
  start_timestamp = event.timeStamp;
}

var first_char = /\S/;
function capitalize(s) {
  return s.replace(first_char, function(m) { return m.toUpperCase(); });
}

var two_line = /\n\n/g;
var one_line = /\n/g;
function linebreak(s) {
  return s.replace(two_line, '<p></p>').replace(one_line, '<br>');
}

function upgrade() {
    document.getElementById("info_upgrade").style.visibility = "visible";
}

</script>
</html>